<html>
<head>
    <title>Exposicion Luminica</title>
    <style>
        body { text-align: center; }
    </style>
</head>
<body>
    <h1>EXPOSICION LUMINICA</h1>
    <p>Exposicion: <span id="exposicionValue"></span>%</p>
    <form>
        <label for="umbral">Umbral:</label>
        <input type="number" id="umbral" name="umbral" required min="0" max="100">
        <button type="submit">Enviar</button>
    </form>
    <div id="alarma" style="display: none;">
        <p><strong>Luminosidad alta!</strong></p>
        <button id="activarAlarma" onclick="activarAlarma()">Activar Alarma</button>
    </div>

    <script>
        let umbral_ini = 100;

        function getExposicionData() {
            fetch('/readExposicion')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('exposicionValue').textContent = data;
                    let exposicion = parseInt(data, 10);
                    let umbral = parseInt(document.getElementById('umbral').value, 10) || umbral_ini;

                    if (exposicion > umbral) {
                        document.getElementById('alarma').style.display = 'block';
                    } else {
                        document.getElementById('alarma').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error al obtener los datos:', error);
                });
        }

        function activarAlarma() {
            console.log('Alarma activada');
            fetch('/activarAlarma', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        console.log('Alarma activada en el servidor');
                    } else {
                        console.error('Error al activar la alarma');
                    }
                })
                .catch(error => {
                    console.error('Error en la solicitud de alarma:', error);
                });
        }

        document.querySelector('form').addEventListener('submit', (event) => {
            event.preventDefault();
            const umbral = document.getElementById('umbral').value;
            fetch('/setUmbral', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `umbral=${umbral}`
            })
                .then(response => {
                    if (response.ok) {
                        console.log('Umbral establecido correctamente');
                        document.getElementById('umbralValue').textContent = umbral;
                    } else {
                        console.error('Error al establecer el umbral');
                    }
                })
                .catch(error => {
                    console.error('Error al enviar el formulario:', error);
                });
        });

        getExposicionData();
        setInterval(getExposicionData, 1000);
    </script>
</body>
</html>